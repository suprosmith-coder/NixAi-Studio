<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>NixAi | Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- ===== FIREBASE SDK ===== -->
  <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js",
        "firebase/analytics": "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js"
      }
    }
  </script>

  <style>
    /* ------------------------------
       CYANIX STUDIO â€“â€“ GLOBAL STYLES
       (preserved & extended)
    ------------------------------ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: #03070a;
      background-image: 
        radial-gradient(circle at 15% 30%, rgba(0, 255, 255, 0.03) 0%, transparent 25%),
        radial-gradient(circle at 85% 70%, rgba(0, 200, 255, 0.04) 0%, transparent 30%),
        linear-gradient(145deg, #000408 0%, #0a1015 100%);
      min-height: 100vh;
      color: #e2f3ff;
      line-height: 1.5;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="1" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.025"/></svg>');
      pointer-events: none;
      z-index: 999;
      opacity: 0.3;
    }

    /* Auth & Onboarding (unchanged) */
    .auth-container, .onboarding-container {
      width: 100%;
      max-width: 480px;
      background: rgba(8, 20, 28, 0.8);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(0, 255, 255, 0.25);
      border-radius: 48px;
      padding: 40px 32px;
      box-shadow: 0 30px 50px rgba(0,0,0,0.7), 0 0 0 1px rgba(0,255,255,0.2) inset, 0 0 40px rgba(0,255,255,0.2);
      z-index: 100;
    }

    .auth-header, .onboarding-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-header i, .onboarding-header i {
      font-size: 48px;
      color: #00ffff;
      text-shadow: 0 0 20px cyan;
      margin-bottom: 16px;
    }

    .auth-header h2, .onboarding-header h2 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #b0ffff, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .input-group {
      margin-bottom: 24px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      color: #a0dddd;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .input-group input, .input-group select {
      width: 100%;
      background: rgba(0, 30, 40, 0.7);
      border: 1.5px solid rgba(0, 255, 255, 0.3);
      border-radius: 40px;
      padding: 16px 22px;
      font-size: 16px;
      color: #fff;
      outline: none;
      transition: 0.2s;
    }

    .input-group input:focus, .input-group select:focus {
      border-color: #00ffff;
      box-shadow: 0 0 0 3px rgba(0,255,255,0.2), 0 0 20px cyan;
      background: rgba(0, 40, 55, 0.9);
    }

    .btn-block {
      width: 100%;
      padding: 16px;
      font-size: 18px;
      margin-top: 16px;
      border-radius: 40px;
    }

    .toggle-link {
      text-align: center;
      margin-top: 28px;
      color: #6fafaf;
      cursor: pointer;
      font-weight: 500;
      transition: 0.2s;
    }

    .toggle-link:hover {
      color: cyan;
      text-shadow: 0 0 8px cyan;
    }

    /* ---------- DASHBOARD LAYOUT (3 columns) ---------- */
    .dashboard {
      display: none; /* shown after auth+onboarding */
      width: 100%;
      max-width: 1600px;
      padding: 24px;
      gap: 24px;
      grid-template-columns: 280px 1fr 300px;
      height: 95vh;
      z-index: 100;
    }

    .side-col {
      background: rgba(8, 20, 28, 0.6);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(0, 255, 255, 0.18);
      border-radius: 40px;
      padding: 28px 16px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      box-shadow: 0 20px 35px -10px black, 0 0 0 1px rgba(0,255,255,0.1) inset;
    }

    .left-col .feature-btn {
      background: transparent;
      border: 1px solid rgba(0,255,255,0.2);
      border-radius: 60px;
      padding: 16px 20px;
      color: #b3ffff;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 16px;
      transition: 0.2s;
      cursor: pointer;
      width: 100%;
      backdrop-filter: blur(5px);
    }

    .left-col .feature-btn i {
      font-size: 24px;
      color: #00ffff;
      width: 32px;
      text-align: center;
    }

    .left-col .feature-btn:hover, .left-col .feature-btn.active {
      background: rgba(0, 255, 255, 0.1);
      border-color: cyan;
      box-shadow: 0 0 20px rgba(0,255,255,0.3);
      color: white;
    }

    .center-col {
      background: rgba(8, 20, 28, 0.5);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(0, 255, 255, 0.18);
      border-radius: 40px;
      padding: 28px 24px;
      overflow-y: auto;
      box-shadow: 0 20px 35px -10px black, 0 0 0 1px rgba(0,255,255,0.1) inset;
    }

    .right-col {
      gap: 16px;
    }

    .user-card {
      background: rgba(0, 255, 255, 0.05);
      border: 1px solid rgba(0,255,255,0.2);
      border-radius: 40px;
      padding: 24px 20px;
      text-align: center;
    }

    .user-avatar {
      font-size: 56px;
      color: cyan;
      margin-bottom: 12px;
    }

    .user-name {
      font-size: 20px;
      font-weight: 700;
    }

    .user-email {
      font-size: 13px;
      color: #7fc9c9;
      word-break: break-all;
    }

    .signout-btn {
      background: transparent;
      border: 1px solid #ff7790;
      color: #ffb0c0;
      border-radius: 40px;
      padding: 12px;
      margin-top: 24px;
      cursor: pointer;
      transition: 0.2s;
    }

    .signout-btn:hover {
      background: #ff4477;
      color: black;
      border-color: #ff4477;
    }

    /* Mode switcher */
    .mode-switch {
      display: flex;
      background: rgba(0,30,40,0.7);
      border-radius: 60px;
      padding: 6px;
      border: 1px solid cyan;
      margin-bottom: 16px;
    }

    .mode-option {
      flex: 1;
      text-align: center;
      padding: 12px 0;
      border-radius: 40px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s;
    }

    .mode-option.active {
      background: cyan;
      color: black;
      box-shadow: 0 0 15px cyan;
    }

    .feature-pane {
      display: none;
    }

    .feature-pane.active-pane {
      display: block;
    }

    /* Preserve original card styles */
    .card {
      background: transparent;
      border: none;
      padding: 0;
      box-shadow: none;
    }
    .card-header {
      margin-bottom: 24px;
      font-size: 20px;
      font-weight: 700;
      color: #b3ffff;
      border-bottom: 1px solid rgba(0,255,255,0.2);
      padding-bottom: 16px;
    }
    .entries-container, .task-list {
      max-height: 400px;
    }

    /* New feature styles */
    .preset-grid, .theme-grid {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin: 16px 0;
    }
    .preset-item, .theme-item {
      background: rgba(0,255,255,0.1);
      border: 1px solid cyan;
      border-radius: 30px;
      padding: 10px 20px;
      cursor: pointer;
    }
    .slider-group {
      margin: 20px 0;
    }
    .slider-label {
      display: flex;
      justify-content: space-between;
    }
    input[type=range] {
      width: 100%;
      background: transparent;
    }
    .analytics-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 20px;
    }
    .analytics-card {
      background: rgba(0,30,40,0.7);
      border-radius: 24px;
      padding: 24px;
      text-align: center;
      border: 1px solid cyan;
    }
    .api-key-demo {
      background: #0a1a22;
      padding: 20px;
      border-radius: 24px;
      font-family: monospace;
      margin: 16px 0;
    }
    .node-editor {
      height: 200px;
      background: #0e202a;
      border-radius: 32px;
      border: 2px dashed cyan;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sandbox-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div id="appRoot"></div>

  <!-- AgentX Chat (only chat we keep) -->
  <script defer>
    document.body.appendChild(document.createElement('div')).setAttribute('id','chatBubbleRoot');
    window.agx = '6966b3b9ff2f8569ae243c64eqzJDjZgS87B5TfiPzQ+mw==|tIbVARHbb3vxisAHOtTxmc1gthpRt6O388wxaCp3rAA=';
  </script>
  <script defer src="https://storage.googleapis.com/agentx-cdn-01/agentx-chat.js"></script>

  <script type="module">
    // ==================== FIREBASE INIT ====================
    import { initializeApp } from "firebase/app";
    import { getAnalytics } from "firebase/analytics";
    import { 
      getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, 
      GoogleAuthProvider, signInWithPopup, onAuthStateChanged 
    } from "firebase/auth";
    import { getFirestore, doc, setDoc, getDoc } from "firebase/firestore";

    const firebaseConfig = {
      apiKey: "AIzaSyAtUrEx-xIDqYZsIzWU-mG8_Fbc3s6D3Ic",
      authDomain: "nixai-d93cb.firebaseapp.com",
      projectId: "nixai-d93cb",
      storageBucket: "nixai-d93cb.firebasestorage.app",
      messagingSenderId: "120045328987",
      appId: "1:120045328987:web:01ab5651163b5c6c483d7e",
      measurementId: "G-4J7K0ZFMNT"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // ==================== APP STATE ====================
    let currentUser = null;
    let onboardingCompleted = false;
    let activeFeature = 'journal';        // default feature
    let currentMode = 'creator';          // 'creator' or 'developer'

    // ==================== RENDER FUNCTIONS ====================
    const appRoot = document.getElementById('appRoot');

    function renderAuth() { /* same as before */ 
      appRoot.innerHTML = `
        <div class="auth-container">
          <div class="auth-header">
            <i class="fas fa-microchip"></i>
            <h2>Cyanix AI Â· studio</h2>
            <p style="color:#9fc; margin-top:8px;">sign in to continue</p>
          </div>
          <div id="authForm">
            <div class="input-group">
              <label>Email</label>
              <input type="email" id="emailInput" placeholder="cyber@creator.space">
            </div>
            <div class="input-group">
              <label>Password</label>
              <input type="password" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn btn-block" id="signInBtn"><i class="fas fa-arrow-right-to-bracket"></i> Sign In</button>
            <button class="btn btn-block" id="googleSignInBtn" style="margin-top:12px; background:rgba(0,255,255,0.1);"><i class="fab fa-google"></i> Continue with Google</button>
            <div class="toggle-link" id="toggleSignUp">Don't have an account? Sign up</div>
          </div>
        </div>
      `;
      document.getElementById('signInBtn').addEventListener('click', () => {
        const email = document.getElementById('emailInput').value;
        const pass = document.getElementById('passwordInput').value;
        signInWithEmailAndPassword(auth, email, pass).catch(alert);
      });
      document.getElementById('googleSignInBtn').addEventListener('click', () => {
        signInWithPopup(auth, provider).catch(alert);
      });
      document.getElementById('toggleSignUp').addEventListener('click', () => {
        appRoot.innerHTML = `
          <div class="auth-container">
            <div class="auth-header">
              <i class="fas fa-microchip"></i>
              <h2>Create account</h2>
            </div>
            <div id="authForm">
              <div class="input-group">
                <label>Email</label>
                <input type="email" id="signupEmail" placeholder="neo@cyanix.ai">
              </div>
              <div class="input-group">
                <label>Password</label>
                <input type="password" id="signupPass" placeholder="min 6 chars">
              </div>
              <button class="btn btn-block" id="signUpBtn"><i class="fas fa-user-plus"></i> Sign Up</button>
              <div class="toggle-link" id="toggleSignIn">Already have an account? Sign in</div>
            </div>
          </div>
        `;
        document.getElementById('signUpBtn').addEventListener('click', () => {
          const email = document.getElementById('signupEmail').value;
          const pass = document.getElementById('signupPass').value;
          createUserWithEmailAndPassword(auth, email, pass).catch(alert);
        });
        document.getElementById('toggleSignIn').addEventListener('click', renderAuth);
      });
    }

    function renderOnboarding() { /* same as before */
      appRoot.innerHTML = `
        <div class="onboarding-container">
          <div class="onboarding-header">
            <i class="fas fa-pen-to-square"></i>
            <h2>Welcome, trailblazer</h2>
            <p style="color:#9cf; margin: 8px 0;">help us personalize your journey</p>
          </div>
          <div class="input-group">
            <label>Where did you hear about Cyanix AI?</label>
            <select id="q1">
              <option>Twitter / X</option>
              <option>LinkedIn</option>
              <option>GitHub</option>
              <option>Friend / colleague</option>
              <option>Other</option>
            </select>
          </div>
          <div class="input-group">
            <label>What is your primary role?</label>
            <select id="q2">
              <option>Developer</option>
              <option>Designer</option>
              <option>Product manager</option>
              <option>Researcher</option>
              <option>Student</option>
              <option>Other</option>
            </select>
          </div>
          <div class="input-group">
            <label>Why are you using Cyanix AI?</label>
            <select id="q3">
              <option>AI exploration</option>
              <option>Image / design work</option>
              <option>Code assistance</option>
              <option>Journaling & tasks</option>
              <option>All of the above</option>
            </select>
          </div>
          <div class="input-group">
            <label>How often do you plan to use it?</label>
            <select id="q4">
              <option>Daily</option>
              <option>Weekly</option>
              <option>Occasionally</option>
              <option>Just trying out</option>
            </select>
          </div>
          <button class="btn btn-block" id="submitOnboarding">Start exploring <i class="fas fa-rocket"></i></button>
        </div>
      `;
      document.getElementById('submitOnboarding').addEventListener('click', async () => {
        if (!currentUser) return;
        const answers = {
          q1: document.getElementById('q1').value,
          q2: document.getElementById('q2').value,
          q3: document.getElementById('q3').value,
          q4: document.getElementById('q4').value,
        };
        await setDoc(doc(db, 'users', currentUser.uid), { onboarding: answers, email: currentUser.email });
        onboardingCompleted = true;
        renderDashboard();
      });
    }

    function renderDashboard() {
      appRoot.innerHTML = `
        <div class="dashboard" style="display: grid;">
          <!-- LEFT COLUMN (features) -->
          <div class="side-col left-col" id="leftCol"></div>

          <!-- CENTER COLUMN (active feature) -->
          <div class="center-col" id="centerPane"></div>

          <!-- RIGHT COLUMN (user + mode) -->
          <div class="side-col right-col" id="rightCol"></div>
        </div>
      `;

      // Build right column (user + mode switch)
      document.getElementById('rightCol').innerHTML = `
        <div class="user-card">
          <div class="user-avatar"><i class="fas fa-circle-user"></i></div>
          <div class="user-name">${currentUser?.displayName || 'Cyanix User'}</div>
          <div class="user-email">${currentUser?.email}</div>
          <div class="mode-switch" id="modeSwitch">
            <div class="mode-option ${currentMode === 'creator' ? 'active' : ''}" data-mode="creator">ðŸŸ¢ Creator</div>
            <div class="mode-option ${currentMode === 'developer' ? 'active' : ''}" data-mode="developer">ðŸ”µ Developer</div>
          </div>
          <button class="signout-btn" id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign out</button>
        </div>
        <div style="background: rgba(0,255,255,0.03); border-radius: 40px; padding: 24px;">
          <h4 style="color: cyan; margin-bottom: 16px;"><i class="fas fa-chart-line"></i> Recent activity</h4>
          <p style="color:#7bb2b2; font-size: 14px;">â€¢ Journal: "Designed glass UI"</p>
          <p style="color:#7bb2b2; font-size: 14px;">â€¢ Task: "Finish hover states"</p>
          <p style="color:#7bb2b2; font-size: 14px;">â€¢ AI App Builder: created assistant</p>
        </div>
      `;

      // Mode switching logic
      document.querySelectorAll('.mode-option').forEach(opt => {
        opt.addEventListener('click', (e) => {
          const mode = e.target.dataset.mode;
          if (mode === currentMode) return;
          currentMode = mode;
          // Update active class
          document.querySelectorAll('.mode-option').forEach(el => el.classList.remove('active'));
          e.target.classList.add('active');
          // Rebuild left column for new mode
          buildLeftColumn();
          // Set default feature for mode
          activeFeature = (mode === 'creator') ? 'journal' : 'modelLab';
          showFeature(activeFeature);
        });
      });

      // Build left column based on mode
      function buildLeftColumn() {
        const leftCol = document.getElementById('leftCol');
        if (currentMode === 'creator') {
          leftCol.innerHTML = `
            <div class="feature-btn active" data-feature="journal"><i class="fas fa-book-open"></i> Journal</div>
            <div class="feature-btn" data-feature="tasks"><i class="fas fa-list-check"></i> Task Forge</div>
            <div class="feature-btn" data-feature="image"><i class="fas fa-image"></i> Image Editor</div>
            <div class="feature-btn" data-feature="code"><i class="fas fa-code"></i> Code Builder (Python)</div>
            <div class="feature-btn" data-feature="aiAppBuilder"><i class="fas fa-bolt"></i> AI App Builder</div>
            <div class="feature-btn" data-feature="promptPlayground"><i class="fas fa-pen-to-square"></i> Prompt Playground</div>
            <div class="feature-btn" data-feature="analytics"><i class="fas fa-chart-simple"></i> Simple Analytics</div>
          `;
        } else {
          leftCol.innerHTML = `
            <div class="feature-btn active" data-feature="modelLab"><i class="fas fa-flask"></i> Model Lab</div>
            <div class="feature-btn" data-feature="apiManager"><i class="fas fa-key"></i> API Manager</div>
            <div class="feature-btn" data-feature="logicBuilder"><i class="fas fa-diagram-project"></i> Logic Builder</div>
            <div class="feature-btn" data-feature="sandbox"><i class="fas fa-vial"></i> Sandbox</div>
          `;
        }
        // Attach feature click handlers
        document.querySelectorAll('.feature-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            document.querySelectorAll('.feature-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeFeature = btn.dataset.feature;
            showFeature(activeFeature);
          });
        });
      }

      // Initial left col build
      buildLeftColumn();
      // Show default feature
      showFeature(activeFeature);

      // Sign out
      document.getElementById('signOutBtn').addEventListener('click', () => {
        signOut(auth);
      });
    }

    // Show feature in center pane
    function showFeature(feature) {
      const center = document.getElementById('centerPane');
      if (!center) return;

      const panes = {
        // Creator features
        journal: getJournalPane(),
        tasks: getTasksPane(),
        image: getImagePane(),
        code: getCodePane(),
        aiAppBuilder: getAiAppBuilderPane(),
        promptPlayground: getPromptPlaygroundPane(),
        analytics: getAnalyticsPane(),
        // Developer features
        modelLab: getModelLabPane(),
        apiManager: getApiManagerPane(),
        logicBuilder: getLogicBuilderPane(),
        sandbox: getSandboxPane()
      };

      center.innerHTML = panes[feature] || '<p>Select a feature</p>';
      // Initialize feature functionality
      if (feature === 'journal') initJournal();
      if (feature === 'tasks') initTasks();
      if (feature === 'image') initImageEditor();
      if (feature === 'code') initCodeBuilder();
      if (feature === 'aiAppBuilder') initAiAppBuilder();
      if (feature === 'promptPlayground') initPromptPlayground();
      if (feature === 'analytics') initAnalytics();
      if (feature === 'modelLab') initModelLab();
      if (feature === 'apiManager') initApiManager();
      if (feature === 'logicBuilder') initLogicBuilder();
      if (feature === 'sandbox') initSandbox();
    }

    // ---------- Feature pane HTML generators ----------
    function getJournalPane() {
      return `
        <div class="feature-pane active-pane" id="journalPane">
          <div class="card-header"><i class="fas fa-book-open"></i> Cyanix Journal</div>
          <textarea id="journalInput" placeholder="Record your thoughts..."></textarea>
          <button class="btn" id="addEntryBtn"><i class="fas fa-pen-fancy"></i> Add Entry</button>
          <div id="journalEntries" class="entries-container"></div>
        </div>
      `;
    }

    function getTasksPane() {
      return `
        <div class="feature-pane" id="tasksPane">
          <div class="card-header"><i class="fas fa-list-check"></i> Task Forge</div>
          <input type="text" id="taskInput" placeholder="Add new task ...">
          <button class="btn" id="addTaskBtn"><i class="fas fa-plus-circle"></i> Create Task</button>
          <ul id="taskList" class="task-list"></ul>
        </div>
      `;
    }

    function getImagePane() {
      return `
        <div class="feature-pane" id="imagePane">
          <div class="card-header"><i class="fas fa-image"></i> Image Editor</div>
          <div class="image-editor">
            <div class="image-canvas" id="imageCanvas">
              <i class="fas fa-cloud-upload-alt" style="font-size: 40px;"></i> <span>drop or click to upload</span>
            </div>
            <div class="img-controls">
              <button id="grayscaleBtn"><i class="fas fa-droplet"></i> Grayscale</button>
              <button id="brightnessBtn"><i class="fas fa-sun"></i> Brightness +</button>
              <button id="resetImgBtn"><i class="fas fa-undo"></i> Reset</button>
            </div>
          </div>
        </div>
      `;
    }

    function getCodePane() {
      return `
        <div class="feature-pane" id="codePane">
          <div class="card-header"><i class="fas fa-code"></i> Python Playground</div>
          <textarea id="codeInput" class="code-editor" placeholder="# write your python code here...\nprint('hello cyanix')"></textarea>
          <button class="btn" id="runCodeBtn"><i class="fas fa-play"></i> Run</button>
          <div id="codeOutput" class="code-output">â€º output will appear here</div>
        </div>
      `;
    }

    function getAiAppBuilderPane() {
      return `
        <div class="feature-pane" id="aiAppBuilderPane">
          <div class="card-header"><i class="fas fa-bolt"></i> AI App Builder (Visual)</div>
          <div style="margin:20px 0">
            <div style="display:flex; gap:20px; flex-wrap:wrap;">
              <div style="flex:1; min-width:200px;">
                <label>Personality preset</label>
                <div class="preset-grid">
                  <div class="preset-item">Friendly</div>
                  <div class="preset-item">Professional</div>
                  <div class="preset-item">Sarcastic</div>
                  <div class="preset-item">Coach</div>
                </div>
              </div>
              <div style="flex:1;">
                <label>Memory</label>
                <div style="display:flex; gap:10px; margin-top:10px;">
                  <button class="btn" id="shortMem">Short-term</button>
                  <button class="btn" id="longMem">Long-term</button>
                </div>
              </div>
            </div>
            <div style="margin:20px 0;">
              <label>Theme</label>
              <div class="theme-grid">
                <div class="theme-item">Dark</div>
                <div class="theme-item">Light</div>
                <div class="theme-item">Cyan</div>
                <div class="theme-item">Neon</div>
              </div>
            </div>
            <button class="btn" id="deployBtn"><i class="fas fa-rocket"></i> Deploy instantly</button>
            <p style="color:#3eaeae; margin-top:16px;">Deployed: MyAssistant v1 (simulated)</p>
          </div>
        </div>
      `;
    }

    function getPromptPlaygroundPane() {
      return `
        <div class="feature-pane" id="promptPlaygroundPane">
          <div class="card-header"><i class="fas fa-pen-to-square"></i> Prompt Playground Lite</div>
          <textarea id="promptInput" placeholder="Enter your prompt..." style="height:120px;"></textarea>
          <div class="slider-group">
            <div class="slider-label"><span>Creativity</span><span id="creativityVal">0.7</span></div>
            <input type="range" id="creativitySlider" min="0" max="1" step="0.1" value="0.7">
          </div>
          <div class="slider-group">
            <div class="slider-label"><span>Response length</span><span id="lengthVal">150</span></div>
            <input type="range" id="lengthSlider" min="50" max="500" step="10" value="150">
          </div>
          <div class="input-group">
            <label>Tone</label>
            <select id="toneSelect">
              <option>Neutral</option>
              <option>Formal</option>
              <option>Casual</option>
              <option>Enthusiastic</option>
            </select>
          </div>
          <button class="btn" id="saveTemplateBtn"><i class="fas fa-save"></i> Save as template</button>
        </div>
      `;
    }

    function getAnalyticsPane() {
      return `
        <div class="feature-pane" id="analyticsPane">
          <div class="card-header"><i class="fas fa-chart-simple"></i> Simple Analytics</div>
          <div class="analytics-cards">
            <div class="analytics-card">
              <i class="fas fa-comments" style="font-size:32px;"></i>
              <h3>1.2k</h3>
              <p>Conversations</p>
            </div>
            <div class="analytics-card">
              <i class="fas fa-user-plus"></i>
              <h3>342</h3>
              <p>User growth</p>
            </div>
            <div class="analytics-card">
              <i class="fas fa-cloud-arrow-up"></i>
              <h3>8.4k</h3>
              <p>API usage</p>
            </div>
            <div class="analytics-card">
              <i class="fas fa-clock"></i>
              <h3>4.2m</h3>
              <p>Engagement time</p>
            </div>
          </div>
        </div>
      `;
    }

    // Developer panes
    function getModelLabPane() {
      return `
        <div class="feature-pane" id="modelLabPane">
          <div class="card-header"><i class="fas fa-flask"></i> Model Lab</div>
          <div style="margin-bottom:16px;">
            <button class="btn"><i class="fas fa-upload"></i> Upload dataset</button>
            <button class="btn"><i class="fas fa-eye"></i> Tokenizer viewer</button>
          </div>
          <div style="background:#0f202b; border-radius:24px; padding:20px;">
            <p>Loss graph (demo)</p>
            <div style="height:100px; background:#1a333e; border-radius:16px; display:flex; align-items:flex-end; padding:8px;">
              <div style="width:20%; background:cyan; height:40%;"></div>
              <div style="width:20%; background:cyan; height:70%;"></div>
              <div style="width:20%; background:cyan; height:30%;"></div>
              <div style="width:20%; background:cyan; height:90%;"></div>
              <div style="width:20%; background:cyan; height:50%;"></div>
            </div>
          </div>
          <div style="margin-top:16px;">
            <label>Version control: v2.3.1</label>
          </div>
        </div>
      `;
    }

    function getApiManagerPane() {
      return `
        <div class="feature-pane" id="apiManagerPane">
          <div class="card-header"><i class="fas fa-key"></i> API & Endpoint Manager</div>
          <div class="api-key-demo">
            <code>api_live_cynx_xxxxxxxxxxxx</code>
          </div>
          <button class="btn"><i class="fas fa-rotate"></i> Generate new key</button>
          <div style="margin-top:20px;">
            <label>Rate limit: 1000/min</label>
            <input type="range" min="100" max="5000" value="1000">
          </div>
          <div style="margin-top:20px;">
            <button class="btn"><i class="fas fa-eye"></i> Logs</button>
            <button class="btn"><i class="fas fa-link"></i> Webhooks</button>
          </div>
        </div>
      `;
    }

    function getLogicBuilderPane() {
      return `
        <div class="feature-pane" id="logicBuilderPane">
          <div class="card-header"><i class="fas fa-diagram-project"></i> Logic & Workflow Builder</div>
          <div class="node-editor">
            <i class="fas fa-arrows-up-down-left-right" style="font-size:32px; color:cyan;"></i>
            <span style="margin-left:16px;">Drag & drop nodes (demo)</span>
          </div>
          <div style="margin-top:20px;">
            <button class="btn"><i class="fas fa-database"></i> Connect Firebase</button>
          </div>
        </div>
      `;
    }

    function getSandboxPane() {
      return `
        <div class="feature-pane" id="sandboxPane">
          <div class="card-header"><i class="fas fa-vial"></i> Sandbox & Testing</div>
          <div class="sandbox-controls">
            <button class="btn"><i class="fas fa-users"></i> Simulate 100 users</button>
            <button class="btn"><i class="fas fa-chart-line"></i> Load test</button>
          </div>
          <div style="margin-top:20px; background:#0f202b; border-radius:24px; padding:16px;">
            <p>Debug console</p>
            <pre style="color:#7fd1d1;">> consistency check passed</pre>
          </div>
        </div>
      `;
    }

    // ---------- Feature initializers (original + new) ----------
    function initJournal() {
      const journalInput = document.getElementById('journalInput');
      const addEntryBtn = document.getElementById('addEntryBtn');
      const journalContainer = document.getElementById('journalEntries');
      if (!journalContainer) return;

      function addJournalEntry(text) {
        if (!text.trim()) return;
        const entryDiv = document.createElement('div');
        entryDiv.className = 'entry';
        entryDiv.innerHTML = `
          <span class="entry-text">${text}</span>
          <span class="entry-time">${new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' })}</span>
          <i class="fas fa-trash delete-entry"></i>
        `;
        journalContainer.appendChild(entryDiv);
      }
      journalContainer.innerHTML = '';
      addJournalEntry('Designed Cyanix glass UI â€“ it glows!');
      addJournalEntry('AI chat responding with fluid animations.');

      addEntryBtn?.addEventListener('click', () => {
        addJournalEntry(journalInput.value);
        journalInput.value = '';
      });
      journalContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-entry')) {
          e.target.closest('.entry').remove();
        }
      });
    }

    function initTasks() {
      const taskInput = document.getElementById('taskInput');
      const addTaskBtn = document.getElementById('addTaskBtn');
      const taskList = document.getElementById('taskList');
      if (!taskList) return;
      function addTask(text) {
        if (!text.trim()) return;
        const li = document.createElement('li');
        li.innerHTML = `
          <input type="checkbox">
          <span class="task-text">${text}</span>
          <i class="fas fa-trash delete-task"></i>
        `;
        taskList.appendChild(li);
      }
      taskList.innerHTML = '';
      addTask('Implement journal delete');
      addTask('Finish cyan neon hover states');
      addTaskBtn?.addEventListener('click', () => {
        addTask(taskInput.value);
        taskInput.value = '';
      });
      taskList.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-task')) {
          e.target.closest('li').remove();
        }
      });
      taskList.addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
          e.target.nextElementSibling.classList.toggle('completed', e.target.checked);
        }
      });
    }

    function initImageEditor() {
      const canvasDiv = document.getElementById('imageCanvas');
      if (!canvasDiv) return;
      canvasDiv.style.background = '#11212e';
      canvasDiv.innerHTML = '<i class="fas fa-image" style="font-size:40px;"></i> <span>sample image (simulated)</span>';
      document.getElementById('grayscaleBtn')?.addEventListener('click', () => canvasDiv.style.filter = 'grayscale(1)');
      document.getElementById('brightnessBtn')?.addEventListener('click', () => canvasDiv.style.filter = 'brightness(1.5)');
      document.getElementById('resetImgBtn')?.addEventListener('click', () => canvasDiv.style.filter = 'none');
    }

    function initCodeBuilder() {
      const runBtn = document.getElementById('runCodeBtn');
      const codeInput = document.getElementById('codeInput');
      const outputDiv = document.getElementById('codeOutput');
      if (!outputDiv) return;
      runBtn?.addEventListener('click', () => {
        const code = codeInput.value;
        outputDiv.innerText = `>>> ${code}\n[simulated output] Hello, Cyanix coder!`;
      });
    }

    function initAiAppBuilder() {
      document.getElementById('shortMem')?.addEventListener('click', () => alert('Short-term memory enabled (demo)'));
      document.getElementById('longMem')?.addEventListener('click', () => alert('Long-term memory enabled (demo)'));
      document.getElementById('deployBtn')?.addEventListener('click', () => alert('App deployed! (simulated)'));
    }

    function initPromptPlayground() {
      const creativity = document.getElementById('creativitySlider');
      const length = document.getElementById('lengthSlider');
      const creativityVal = document.getElementById('creativityVal');
      const lengthVal = document.getElementById('lengthVal');
      creativity?.addEventListener('input', () => creativityVal.innerText = creativity.value);
      length?.addEventListener('input', () => lengthVal.innerText = length.value);
      document.getElementById('saveTemplateBtn')?.addEventListener('click', () => alert('Template saved (demo)'));
    }

    function initAnalytics() { /* static */ }
    function initModelLab() { /* static */ }
    function initApiManager() { /* static */ }
    function initLogicBuilder() { /* static */ }
    function initSandbox() { /* static */ }

    // ==================== AUTH STATE OBSERVER ====================
    onAuthStateChanged(auth, async (user) => {
      currentUser = user;
      if (user) {
        const docRef = doc(db, 'users', user.uid);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists() && docSnap.data().onboarding) {
          onboardingCompleted = true;
          renderDashboard();
        } else {
          renderOnboarding();
        }
      } else {
        renderAuth();
      }
    });

    renderAuth(); // initial
  </script>
</body>
  </html>
